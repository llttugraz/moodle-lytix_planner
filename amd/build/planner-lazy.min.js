define("lytix_planner/planner-lazy",["exports","core/ajax","core/modal_factory","core/modal_events","core/fragment","core/str","lytix_logs/logs","core/log","lytix_planner/modal_save_delete_cancel-lazy","lytix_helper/widget"],(function(_exports,_ajax,_modal_factory,_modal_events,_fragment,_str,_logs,_log,_modal_save_delete_cancelLazy,_widget){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_log=_interopRequireDefault(_log),_modal_save_delete_cancelLazy=_interopRequireDefault(_modal_save_delete_cancelLazy),_widget=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(_widget);const svgcontainer=document.getElementById("PlannerWidget"),plannerLeft=document.getElementById("planner_left"),plannerRight=document.getElementById("planner_right"),plannerLegend=document.getElementById("planner_legend"),plannerOptions=document.getElementById("planner_options"),plannerActions=document.getElementById("planner_actions"),plannerMenu=document.getElementById("planner_menu"),NS="http://www.w3.org/2000/svg";let log,svgElement=null,svgHeight=350,svgWidth=600;const eventStrings={},planner={contextid:-1,courseid:-1,userid:-1,isteacher:-1,strings:null,locale:"default",isresizing:!1,paddingleft:15,paddingright:15,padding:4,barHeight:20,days:0,months:0,weeks:0,startDate:null,endDate:null,yearStartDate:null,daysWidth:0,monthWidth:0,weekWidth:0,weekHeight:0,data:null,showMonthFlag:!1,primaryMarkerColour:"#a09e9e",indicatorColour:"#888686",fontColour:"#fefefe",indicatorStrokeColour:"#595656",stillDueColour:"#474747",milestoneColour:"#df3540",completedColour:"#b2c204",thresholdColour:"#f9a606",view:null,inactiveMonths:[],activeMonths:[],currentMonth:null,weeksInMonth:new Map,daysInWeek:new Map,autoScrolling:!1,includeTypes:null,includedTypes:null,storedEvents:new Map,storedMilestones:new Map,dateFormatter:null,timeFormatter:null,init:function(data){null!==svgcontainer&&(svgWidth=svgcontainer.offsetWidth),svgcontainer.innerHTML="",plannerLeft.innerHTML="",plannerRight.innerHTML="",plannerLegend.innerHTML="",plannerOptions.innerHTML="",plannerActions.innerHTML="";const mobileArrows=document.getElementsByClassName("planner-mobileArrows");mobileArrows.length>0&&(mobileArrows[0].innerHTML="",mobileArrows[0].parentNode.removeChild(mobileArrows[0])),svgElement=document.createElementNS(NS,"svg"),svgElement.setAttributeNS(null,"id","planner-svg"),document.addEventListener("click",(event=>{if(!document.getElementById("planner-mergePopup").contains(event.target)){const mergeElements=document.getElementsByClassName("merge");let merge=!1;mergeElements.forEach((function(element){event.target===element&&(merge=!0)})),merge||this.closePopup()}if(!document.getElementById("planner-check").contains(event.target)&&window.innerWidth<767){document.getElementById("menuform").style.left="-150%"}if(!document.getElementById("planner-infoMobile").contains(event.target)&&window.innerWidth<767){document.getElementById("planner-info").style.left="-150%"}})),planner.isteacher?document.getElementById("planner_description").innerText=planner.strings.description_teacher:document.getElementById("planner_description").innerText=planner.strings.description_student,planner.data=data,planner.startDate=new Date(1e3*data.startDate);const date=new Date(1e3*data.endDate);date.setHours(23),date.setMinutes(59),planner.endDate=date;const utcStart=Date.UTC(planner.startDate.getFullYear(),planner.startDate.getMonth(),planner.startDate.getDate()),utcEnd=Date.UTC(planner.endDate.getFullYear(),planner.endDate.getMonth(),planner.endDate.getDate());planner.days=Math.floor((utcEnd-utcStart)/864e5),planner.months=planner.endDate.getMonth()-planner.startDate.getMonth()+1+12*(planner.endDate.getFullYear()-planner.startDate.getFullYear());const currentMonthIndex=(new Date).getMonth(),copiedStartDate=new Date(planner.startDate.getTime());for(let i=0;i<planner.months;i++){const genericMonthCount=new Date(copiedStartDate.getFullYear(),copiedStartDate.getMonth()+1,0).getDate(),startDate=new Date(copiedStartDate.getFullYear(),copiedStartDate.getMonth(),1),endDate=new Date(copiedStartDate.getFullYear(),copiedStartDate.getMonth(),genericMonthCount),weekNR=this.getWeek(startDate),endWeekNR=this.getWeek(endDate);currentMonthIndex===startDate.getMonth()&&(planner.currentMonth=i),planner.weeksInMonth.set(startDate.getMonth().toString()+startDate.getFullYear().toString(),[weekNR,endWeekNR]),copiedStartDate.setMonth(copiedStartDate.getMonth()+1,1)}planner.inactiveMonths.length=0,planner.activeMonths.length=0,window.innerWidth<=767?this.initMobile():this.initDesktop()},initDesktop(){svgElement.setAttributeNS(null,"height",svgHeight),svgcontainer.appendChild(svgElement);let arrows=this.createArrows(plannerLeft,plannerRight,!1);this.createIndicators(plannerLeft,plannerRight);let rightDrop=document.getElementById("rightArrowDropMenu");if(planner.view==="3 "+planner.strings.months||null===planner.view){planner.view="3 "+planner.strings.months,planner.monthWidth=(svgWidth-2*planner.padding-(planner.paddingleft+planner.paddingright))/3,planner.dayWidth=(svgWidth-2*planner.padding-(planner.paddingleft+planner.paddingright))/planner.days,svgcontainer.style.overflowX="auto";let sWidth=planner.monthWidth*planner.months+planner.paddingright+planner.paddingleft+planner.months*planner.padding;svgElement.setAttributeNS(null,"width",sWidth);let pos=0;pos=planner.months>planner.currentMonth&&planner.currentMonth-1>=0?-1:planner.currentMonth-1>=0?planner.currentMonth-2>=0?-2:-1:0;const scrollToAmount=(planner.monthWidth+planner.padding)*(planner.currentMonth+pos);svgcontainer.scrollTo({top:0,left:scrollToAmount,behavior:"instant"}),this.addHiddenMonths();let date=new Date(planner.startDate.getTime());planner.activeMonths.push([date.getMonth(),date.getFullYear()]),date.setMonth(date.getMonth()+1),planner.months>1&&(planner.activeMonths.push([date.getMonth(),date.getFullYear()]),date.setMonth(date.getMonth()+1),planner.months>2&&(planner.activeMonths.push([date.getMonth(),date.getFullYear()]),date.setMonth(date.getMonth()+1)));let nextM=document.createElement("a");nextM.setAttribute("href","#"),nextM.innerText=planner.strings.next+" >",nextM.addEventListener("click",(()=>{const newPos=(svgcontainer.scrollLeft/planner.monthWidth+1).toFixed(0)*(planner.monthWidth+planner.padding);svgcontainer.scrollTo({top:0,left:newPos,behavior:"smooth"})})),arrows[0].addEventListener("click",(()=>{const newPos=(svgcontainer.scrollLeft/planner.monthWidth-1).toFixed(0)*(planner.monthWidth+planner.padding);svgcontainer.scrollTo({top:0,left:newPos,behavior:"smooth"})})),arrows[1].addEventListener("click",(()=>{const newPos=(svgcontainer.scrollLeft/planner.monthWidth+1).toFixed(0)*(planner.monthWidth+planner.padding);svgcontainer.scrollTo({top:0,left:newPos,behavior:"smooth"})})),rightDrop.appendChild(nextM)}else if(planner.view===planner.strings.month){planner.monthWidth=svgWidth-(planner.paddingleft+planner.paddingright),planner.dayWidth=(svgWidth-(planner.paddingleft+planner.paddingright))/planner.days,svgcontainer.style.overflowX="auto";const sWidth=(planner.monthWidth+planner.padding)*planner.months+planner.paddingright+planner.paddingleft;svgElement.setAttributeNS(null,"width",sWidth);const scrollToAmount=(planner.monthWidth+planner.padding)*planner.currentMonth;svgcontainer.scrollTo({top:0,left:scrollToAmount,behavior:"instant"}),this.addHiddenMonths();const date=new Date(planner.startDate.getTime());planner.activeMonths.push([date.getMonth(),date.getFullYear()]),date.setMonth(date.getMonth()+1);const nextM=document.createElement("a");nextM.setAttribute("href","#"),nextM.innerText=planner.strings.next+" >",nextM.addEventListener("click",(()=>{const newPos=(svgcontainer.scrollLeft/planner.monthWidth+1).toFixed(0)*(planner.monthWidth+planner.padding);svgcontainer.scrollTo({top:0,left:newPos,behavior:"smooth"})})),arrows[1].addEventListener("click",(()=>{const newPos=(svgcontainer.scrollLeft/planner.monthWidth+1).toFixed(0)*(planner.monthWidth+planner.padding);svgcontainer.scrollTo({top:0,left:newPos,behavior:"smooth"})})),arrows[0].addEventListener("click",(()=>{const newPos=(svgcontainer.scrollLeft/planner.monthWidth-1).toFixed(0)*(planner.monthWidth+planner.padding);svgcontainer.scrollTo({top:0,left:newPos,behavior:"smooth"})}))}else{let tooSmall=!1;if(planner.monthWidth=(svgWidth-planner.padding*(planner.months-1)-(planner.paddingleft+planner.paddingright))/planner.months,planner.dayWidth=(svgWidth-planner.padding*(planner.months-1)-(planner.paddingleft+planner.paddingright))/planner.days,planner.monthWidth<60&&(tooSmall=!0,planner.monthWidth=60,planner.dayWidth=60*planner.months/planner.days),tooSmall){const sWidth=(planner.monthWidth+planner.padding)*planner.months+planner.paddingright+planner.paddingleft;svgElement.setAttributeNS(null,"width",sWidth),svgcontainer.style.overflowX="scroll"}else svgElement.setAttributeNS(null,"width",svgWidth),svgcontainer.style.overflowX="hidden";const date=new Date(planner.startDate.getTime());for(let i=0;i<planner.months;i++)planner.activeMonths.push([date.getMonth(),date.getFullYear()]),date.setMonth(date.getMonth()+1)}svgcontainer.addEventListener("scroll",this.addHiddenMonths)},initMobile(){svgElement.setAttributeNS(null,"height",600),planner.view=planner.strings.month;const plannerView=document.getElementById("planner_view"),arrowPlacing=document.createElement("div");plannerView.prepend(arrowPlacing);const leftPlace=document.createElement("div"),rightPlace=document.createElement("div"),middlePlace=document.createElement("div");arrowPlacing.appendChild(middlePlace),arrowPlacing.appendChild(leftPlace),arrowPlacing.appendChild(rightPlace),arrowPlacing.setAttribute("class","planner-mobileArrows");const arrows=this.createArrows(leftPlace,rightPlace,!0);this.createIndicators(leftPlace,rightPlace),svgcontainer.appendChild(svgElement);let rightDrop=document.getElementById("rightArrowDropMenu");planner.weekWidth=svgWidth-(planner.paddingleft+planner.paddingright),planner.monthWidth=planner.weekWidth,planner.dayWidth=planner.weekWidth/7,svgcontainer.style.overflowX="auto";let sWidth=(planner.weekWidth+planner.padding)*planner.months+planner.paddingright+planner.paddingleft;svgElement.setAttributeNS(null,"width",sWidth);const date=new Date;planner.activeMonths.push([date.getMonth(),date.getFullYear()]),this.createMobileMonth(middlePlace,date.getMonth(),date.getFullYear());const newPos=(planner.monthWidth+planner.padding)*planner.currentMonth;svgcontainer.scrollTo({top:0,left:newPos,behavior:"instant"});const nextM=document.createElement("a");nextM.setAttribute("href","#"),nextM.innerText=planner.strings.next+" >",nextM.addEventListener("click",(()=>{const newPos=(svgcontainer.scrollLeft/planner.monthWidth+1).toFixed(0)*(planner.monthWidth+planner.padding);svgcontainer.scrollTo({top:0,left:newPos,behavior:"smooth"})})),arrows[1].addEventListener("click",(()=>{const newPos=(svgcontainer.scrollLeft/planner.monthWidth+1).toFixed(0)*(planner.monthWidth+planner.padding);svgcontainer.scrollTo({top:0,left:newPos,behavior:"smooth"})})),arrows[0].addEventListener("click",(()=>{const newPos=(svgcontainer.scrollLeft/planner.monthWidth-1).toFixed(0)*(planner.monthWidth+planner.padding);svgcontainer.scrollTo({top:0,left:newPos,behavior:"smooth"})})),rightDrop.appendChild(nextM),this.addHiddenMonths(),svgcontainer.addEventListener("scroll",this.addHiddenMonths)},getType:function(a){return a.type},createArrows:function(plannerLeft,plannerRight,mobile){const leftArrow=document.createElementNS(NS,"svg");leftArrow.setAttributeNS(null,"width",45),leftArrow.setAttributeNS(null,"height",43),leftArrow.setAttributeNS(null,"fill","none"),leftArrow.setAttributeNS(null,"id","leftArrow");const drawing=document.createElementNS(NS,"path");drawing.setAttributeNS(null,"d","M3.54082 22.8031C2.07838 22.0621 2.07979 19.9729 3.54323 19.2339L33.1014 4.30629C34.4322 3.63422 36.004 4.60203 36.003 6.09289L35.9829 35.9877C35.9819 37.4786 34.4088 38.4443 33.0789 37.7704L3.54082 22.8031Z"),drawing.setAttributeNS(null,"fill",planner.indicatorColour),leftArrow.appendChild(drawing),leftArrow.style.position="absolute",leftArrow.style.bottom="0px",leftArrow.style.left="0px";let dropContainer=document.createElement("div");dropContainer.setAttribute("class","dropdown");const leftButton=document.createElement("button");leftButton.setAttribute("width",leftArrow.getAttribute("width")),leftButton.setAttribute("height",43),leftButton.setAttribute("type","button");let dropMenu=document.createElement("div");dropMenu.setAttribute("class","dropdown-content"),mobile&&dropMenu.setAttribute("class","dropdown-content mobile"),dropMenu.setAttribute("id","leftArrowDropMenu"),dropContainer.style.position="absolute",dropContainer.style.bottom="0px",dropContainer.style.left="0px",leftButton.style.padding="0px",leftButton.style.border="none",leftButton.appendChild(dropMenu),leftButton.appendChild(leftArrow),dropContainer.appendChild(leftButton),plannerLeft.appendChild(dropContainer);const rightArrow=document.createElementNS(NS,"svg");rightArrow.setAttributeNS(null,"width",45),rightArrow.setAttributeNS(null,"height",43),rightArrow.setAttributeNS(null,"fill","none"),rightArrow.setAttributeNS(null,"id","rightArrow");const drawingRight=document.createElementNS(NS,"path");drawingRight.setAttributeNS(null,"d","M44.5203 19.2726C45.9851 20.009 45.9903 22.0982 44.5293 22.8419L15.0188 37.8636C13.6902 38.5399 12.1153 37.5771 12.1115 36.0863L12.0364 6.19149C12.0326 4.70064 13.6027 3.72993 14.9347 4.39955L44.5203 19.2726Z"),drawingRight.setAttributeNS(null,"fill",planner.indicatorColour),rightArrow.appendChild(drawingRight),rightArrow.style.position="absolute",rightArrow.style.bottom="0px",rightArrow.style.right="0px",dropContainer=document.createElement("div"),dropContainer.setAttribute("class","dropdown");const rightButton=document.createElement("button");return rightButton.setAttribute("width",rightArrow.getAttribute("width")),rightButton.setAttribute("height",43),rightButton.setAttribute("type","button"),dropMenu=document.createElement("div"),dropMenu.setAttribute("class","dropdown-content"),mobile&&dropMenu.setAttribute("class","dropdown-content mobile"),dropMenu.setAttribute("id","rightArrowDropMenu"),dropMenu.style.right="0px",dropContainer.style.position="absolute",dropContainer.style.bottom="0px",dropContainer.style.right="0px",rightButton.style.padding="0px",rightButton.style.border="none",rightButton.appendChild(dropMenu),rightButton.appendChild(rightArrow),dropContainer.appendChild(rightButton),plannerRight.appendChild(dropContainer),[leftArrow,rightArrow]},createIndicators:function(plannerLeft,plannerRight){const leftIndicator=document.createElementNS(NS,"svg");leftIndicator.setAttributeNS(null,"height",25),leftIndicator.setAttributeNS(null,"width",25),leftIndicator.style.position="absolute",leftIndicator.style.left="0",leftIndicator.style.bottom="40px";const rightIndicator=document.createElementNS(NS,"svg");rightIndicator.setAttributeNS(null,"height",25),rightIndicator.setAttributeNS(null,"width",25),rightIndicator.style.position="absolute",rightIndicator.style.right="0px",rightIndicator.style.bottom="40px";let leftGroup=document.createElementNS(NS,"g"),rightGroup=document.createElementNS(NS,"g");leftIndicator.appendChild(leftGroup),rightIndicator.appendChild(rightGroup);let indicator=document.createElementNS(NS,"rect");indicator.setAttributeNS(null,"x",1),indicator.setAttributeNS(null,"y",1),indicator.setAttributeNS(null,"height",22),indicator.setAttributeNS(null,"width",22),indicator.setAttributeNS(null,"rx",4),indicator.style.fill=planner.indicatorColour,indicator.style.stroke=planner.indicatorStrokeColour,indicator.style.strokeWidth=2;let leftText=document.createElementNS(NS,"text");leftText.setAttributeNS(null,"id","leftText"),leftText.setAttributeNS(null,"x",12),leftText.setAttributeNS(null,"y",18),leftText.setAttributeNS(null,"dy","0px"),leftText.style.cssText+="text-anchor:middle;font-weight:bold;font-family:sans-serif",leftText.setAttributeNS(null,"fill",planner.fontColour),leftGroup.appendChild(indicator),leftGroup.appendChild(leftText),indicator=document.createElementNS(NS,"rect"),indicator.setAttributeNS(null,"x",1),indicator.setAttributeNS(null,"y",1),indicator.setAttributeNS(null,"height",22),indicator.setAttributeNS(null,"width",22),indicator.setAttributeNS(null,"rx",4),indicator.style.fill=planner.indicatorColour,indicator.style.stroke=planner.indicatorStrokeColour,indicator.style.strokeWidth=2;let rightText=document.createElementNS(NS,"text");rightText.setAttributeNS(null,"id","rightText"),rightText.setAttributeNS(null,"x",12),rightText.setAttributeNS(null,"y",18),rightText.setAttributeNS(null,"dy","0px"),rightText.style.cssText+="text-anchor:middle;font-weight:bold;font-family:sans-serif",rightText.setAttributeNS(null,"fill",planner.fontColour),rightGroup.appendChild(indicator),rightGroup.appendChild(rightText),plannerLeft.appendChild(leftIndicator),plannerRight.appendChild(rightIndicator)},createMobileMonth:function(area,month,year){const monthText=document.createElement("h2"),current=new Date(year,month);return monthText.innerText=current.toLocaleString(planner.locale,{month:"long",year:"numeric"}),monthText.setAttribute("class","planner-mobileMonth"),monthText.setAttribute("id","mobileMonth"),area.appendChild(monthText),monthText},addHiddenMonths:function(){if("gesamtes Semester"===planner.view||"entire semester"===planner.view)return;const mobile=window.innerWidth<767,date=new Date(planner.startDate.getTime()),scrollPos=svgcontainer.scrollLeft,rightDropMenu=document.getElementById("rightArrowDropMenu"),leftDropMenu=document.getElementById("leftArrowDropMenu"),nextM=document.createElement("a");nextM.innerText=planner.strings.next+" >",nextM.addEventListener("click",(()=>{let newPos=(svgcontainer.scrollLeft/planner.monthWidth+1).toFixed(0)*(planner.monthWidth+planner.padding);svgcontainer.scrollTo({top:0,left:newPos,behavior:"smooth"})})),rightDropMenu.appendChild(nextM);let child=rightDropMenu.lastElementChild;for(;child!==rightDropMenu.firstElementChild;)rightDropMenu.removeChild(child),child=rightDropMenu.lastElementChild;const nextMLeft=document.createElement("a");for(nextMLeft.setAttribute("href","#"),nextMLeft.innerText="< "+planner.strings.previous_month,nextMLeft.addEventListener("click",(()=>{const newPos=(svgcontainer.scrollLeft/planner.monthWidth-1).toFixed(0)*(planner.monthWidth+planner.padding);svgcontainer.scrollTo({top:0,left:newPos,behavior:"smooth"})})),leftDropMenu.appendChild(nextMLeft),child=leftDropMenu.lastElementChild;child!==leftDropMenu.firstElementChild;)leftDropMenu.removeChild(child),child=leftDropMenu.lastElementChild;if(planner.inactiveMonths.length=0,planner.activeMonths.length=0,planner.view==="3 "+planner.strings.months)for(let i=0;i<planner.months;i++){if(i*planner.monthWidth+.25*planner.monthWidth<scrollPos){planner.inactiveMonths.push([date.getMonth(),date.getFullYear()]);const month=document.createElement("a");month.setAttribute("class","dropdown-item"),month.setAttribute("href","#"),month.innerText=date.toLocaleString(planner.locale,{year:"numeric",month:"short"}),month.addEventListener("click",(()=>{const scrollToAmount=(planner.monthWidth+planner.padding)*i-planner.monthWidth;svgcontainer.scrollTo({top:0,left:scrollToAmount,behavior:"smooth"})})),leftDropMenu.appendChild(month)}else if(i*planner.monthWidth+.75*planner.monthWidth>=scrollPos+3*planner.monthWidth){planner.inactiveMonths.push([date.getMonth(),date.getFullYear()]);const month=document.createElement("a");month.setAttribute("class","dropdown-item"),month.setAttribute("href","#"),month.innerText=date.toLocaleString(planner.locale,{year:"numeric",month:"short"}),month.addEventListener("click",(()=>{const scrollToAmount=(planner.monthWidth+planner.padding)*i-planner.monthWidth;svgcontainer.scrollTo({top:0,left:scrollToAmount,behavior:"smooth"})})),rightDropMenu.appendChild(month)}else planner.activeMonths.push([date.getMonth(),date.getFullYear()]);date.setMonth(date.getMonth()+1)}else for(let i=0;i<planner.months;i++){if(i*planner.monthWidth+.75*planner.monthWidth<scrollPos){planner.inactiveMonths.push([date.getMonth(),date.getFullYear()]);const month=document.createElement("a");month.setAttribute("class","dropdown-item"),month.setAttribute("href","#"),month.innerText=date.toLocaleString(planner.locale,{year:"numeric",month:"short"}),month.addEventListener("click",(()=>{const scrollToAmount=(planner.monthWidth+planner.padding)*i;svgcontainer.scrollTo({top:0,left:scrollToAmount,behavior:"smooth"})})),leftDropMenu.appendChild(month)}else if(i*planner.monthWidth+.75*planner.monthWidth>=svgcontainer.scrollLeft+planner.monthWidth){planner.inactiveMonths.push([date.getMonth(),date.getFullYear()]);const month=document.createElement("a");month.setAttribute("class","dropdown-item"),month.setAttribute("href","#"),month.innerText=date.toLocaleString(planner.locale,{year:"numeric",month:"short"}),month.addEventListener("click",(()=>{const scrollToAmount=(planner.monthWidth+planner.padding)*i;svgcontainer.scrollTo({top:0,left:scrollToAmount,behavior:"smooth"})})),rightDropMenu.appendChild(month)}else if(planner.activeMonths.push([date.getMonth(),date.getFullYear()]),mobile){const mobileHeader=document.getElementById("mobileMonth"),currentDate=new Date(date.getFullYear(),date.getMonth());mobileHeader.innerText=currentDate.toLocaleString(planner.locale,{month:"long",year:"numeric"})}date.setMonth(date.getMonth()+1)}leftDropMenu.lastElementChild===leftDropMenu.firstElementChild&&leftDropMenu.removeChild(leftDropMenu.firstElementChild),rightDropMenu.lastElementChild===rightDropMenu.firstElementChild&&rightDropMenu.removeChild(rightDropMenu.firstElementChild),planner.updateIndicatorAmounts()},updateIndicatorAmounts:function(){const rightText=document.getElementById("rightText"),leftText=document.getElementById("leftText");let leftAmount=0,rightAmount=0;for(let[key,value]of planner.storedEvents){const date=new Date(key);for(let i=0;i<planner.inactiveMonths.length;i++){const[month,year]=planner.inactiveMonths.at(i);date.getMonth()===month&&date.getFullYear()===year&&(month<planner.activeMonths.at(0)[0]&&year<=planner.activeMonths.at(0)[1]||year<planner.activeMonths.at(0)[1]?leftAmount+=value:rightAmount+=value)}}leftText.textContent=leftAmount.toString(),rightText.textContent=rightAmount.toString()},storeEvents:function(events){planner.storedEvents=new Map,planner.storedMilestones=new Map;for(let i=0;i<events.length;i++){let date=new Date(1e3*events[i].startdate);date.setHours(0),date.setMinutes(0),date=date.getTime(),"Milestone"===events[i].type||"Meilenstein"===events[i].type?planner.storedMilestones.get(date)?planner.storedMilestones.set(date,planner.storedMilestones.get(date)+1):planner.storedMilestones.set(date,1):planner.storedEvents.get(date)?planner.storedEvents.set(date,planner.storedEvents.get(date)+1):planner.storedEvents.set(date,1)}},drawLoading:function(){const img='<img src="../../../pix/i/loading.'+(Number(M.cfg.version)<2024042200?"gif":"svg")+'" alt="LoadingImage" style="width:48px;height:48px;">';svgcontainer.innerHTML=img+" "+planner.strings.loading_msg},updateSvgHeight:function(height){document.querySelector("#planner-svg").setAttributeNS(null,"height",height)},drawplanner:function(){const y=planner.barPosY-planner.barHeight/2,date=new Date(planner.startDate.getTime()),rightText=document.getElementById("rightText"),leftText=document.getElementById("leftText");let leftAmount=0,rightAmount=0;for(let[key,value]of planner.storedEvents){const newdate=new Date(key);for(let i=0;i<planner.inactiveMonths.length;i++){const[month,year]=planner.inactiveMonths.at(i);newdate.getMonth()===month&&newdate.getFullYear()===year&&(month<planner.activeMonths.at(0)[0]&&year<=planner.activeMonths.at(0)[1]?leftAmount+=value:rightAmount+=value)}}leftText.textContent=leftAmount.toString(),rightText.textContent=rightAmount.toString(),window.innerWidth<=767?this.drawMobile(y,date):this.drawDesktop(leftText,rightText,leftAmount,rightAmount,y,date)},drawDesktop:function(leftText,rightText,leftAmount,rightAmount,y,date){for(let i=0;i<planner.months;++i){const newElementline=document.createElementNS(NS,"rect"),x=planner.paddingleft+i*planner.monthWidth+i*planner.padding,width=planner.paddingleft+(i+1)*planner.monthWidth+i*planner.padding-x,height=planner.barHeight;newElementline.setAttributeNS(null,"x",x),newElementline.setAttributeNS(null,"width",width),newElementline.setAttributeNS(null,"y",y),newElementline.setAttributeNS(null,"height",height),newElementline.setAttributeNS(null,"rx",5),newElementline.setAttributeNS(null,"cursor","pointer"),newElementline.setAttributeNS(null,"stroke","#000"),svgElement.appendChild(newElementline);const newElementtext=document.createElementNS(NS,"text"),textx=planner.paddingleft+i*planner.padding+i*planner.monthWidth+planner.monthWidth/2;newElementtext.setAttributeNS(null,"x",textx),newElementtext.setAttributeNS(null,"y",y+height/2),newElementtext.setAttributeNS(null,"dy","6px"),newElementtext.setAttributeNS(null,"cursor","pointer"),newElementtext.style.textAnchor="middle",newElementtext.style.fontWeight="normal",newElementtext.style.fontFamily="sans-serif",newElementtext.setAttributeNS(null,"fill","white"),"gesamtes Semester"===planner.view||"entire semester"===planner.view?newElementtext.textContent=date.toLocaleString(planner.locale,{year:"2-digit",month:"short"}):newElementtext.textContent=date.toLocaleString(planner.locale,{year:"numeric",month:"short"}),svgElement.appendChild(newElementtext),date.setMonth(date.getMonth()+1)}},drawMobile:function(y,date){for(let i=0;i<planner.months;++i){let weeks=planner.weeksInMonth.get(date.getMonth().toString()+date.getFullYear().toString()),weekAmount=weeks[1]-weeks[0]+1;52===weeks[0]&&(weekAmount=6);for(let j=0;j<weekAmount;j++){const year=date.getFullYear();let firstDate,week=0;week=52===weeks[0]?0===j?52:j:weeks[0]+j,firstDate=52===weeks[0]?new Date(year-1,0,4):new Date(year,0,4);let firstDateDay=firstDate.getDay();0===firstDateDay?firstDateDay=6:firstDateDay-=1;const firstDay=new Date(firstDate.setDate(firstDate.getDate()+7*(week-1)-firstDateDay)),lastDay=new Date(firstDate.setDate(firstDate.getDate()+6)),newElementline=document.createElementNS(NS,"rect"),x=planner.paddingleft+i*planner.monthWidth+i*planner.padding,width=planner.paddingleft+(i+1)*planner.monthWidth+i*planner.padding-x,daywith=width/7,height=planner.barHeight;if(newElementline.setAttributeNS(null,"x",x),newElementline.setAttributeNS(null,"width",width),newElementline.setAttributeNS(null,"y",y+j*planner.weekHeight),newElementline.setAttributeNS(null,"height",height),newElementline.setAttributeNS(null,"rx",5),newElementline.setAttributeNS(null,"stroke","#000"),svgElement.appendChild(newElementline),0===j){if(firstDay.getMonth()!==lastDay.getMonth()){let diff=new Date(lastDay.getFullYear(),lastDay.getMonth(),1).getTime()-new Date(firstDay.getFullYear(),firstDay.getMonth(),firstDay.getDate()).getTime();diff/=864e5;const pastMonthLine=document.createElementNS(NS,"rect"),x=planner.paddingleft+i*planner.monthWidth+i*planner.padding,width=x+diff*daywith-x,height=planner.barHeight;pastMonthLine.setAttributeNS(null,"x",x),pastMonthLine.setAttributeNS(null,"width",width),pastMonthLine.setAttributeNS(null,"y",y+j*planner.weekHeight),pastMonthLine.setAttributeNS(null,"height",height),pastMonthLine.setAttributeNS(null,"rx",0),pastMonthLine.setAttributeNS(null,"fill","white"),pastMonthLine.style.opacity="0.8",svgElement.appendChild(pastMonthLine)}}else if(j===weekAmount-1&&firstDay.getMonth()!==lastDay.getMonth()){let diff=new Date(lastDay.getFullYear(),lastDay.getMonth(),lastDay.getDate()).getTime()-new Date(lastDay.getFullYear(),lastDay.getMonth(),1).getTime();diff=diff/864e5+1;const nextMonthLine=document.createElementNS(NS,"rect"),x1=planner.paddingleft+(i+1)*planner.monthWidth+i*planner.padding,x=x1-diff*daywith,width=x1-x,height=planner.barHeight;nextMonthLine.setAttributeNS(null,"x",x),nextMonthLine.setAttributeNS(null,"width",width),nextMonthLine.setAttributeNS(null,"y",y+j*planner.weekHeight),nextMonthLine.setAttributeNS(null,"height",height),nextMonthLine.setAttributeNS(null,"rx",0),nextMonthLine.setAttributeNS(null,"fill","white"),nextMonthLine.style.opacity="0.8",svgElement.appendChild(nextMonthLine)}for(let i=1;i<7;i++){const weekline=document.createElementNS(NS,"line");weekline.setAttributeNS(null,"x1",x+i*daywith),weekline.setAttributeNS(null,"y1",y+j*planner.weekHeight),weekline.setAttributeNS(null,"x2",x+i*daywith),weekline.setAttributeNS(null,"y2",y+j*planner.weekHeight+height),weekline.style.stroke=planner.primaryMarkerColour,weekline.style.strokeWidth="3",weekline.style.opacity="1",svgElement.appendChild(weekline)}const newElementtext=document.createElementNS(NS,"text"),textx=planner.paddingleft+i*planner.padding+i*planner.monthWidth+planner.monthWidth/2;newElementtext.setAttributeNS(null,"x",textx),newElementtext.setAttributeNS(null,"y",y+height/2+j*planner.weekHeight),newElementtext.setAttributeNS(null,"dy","6px"),newElementtext.setAttributeNS(null,"cursor","pointer"),newElementtext.style.textAnchor="middle",newElementtext.style.fontWeight="bold",newElementtext.style.fontFamily="sans-serif",newElementtext.setAttributeNS(null,"fill","white"),newElementtext.textContent+=planner.strings.calendarweek+" "+week+" ("+firstDay.toLocaleDateString(planner.locale,{day:"numeric",month:"numeric"})+" - "+lastDay.toLocaleDateString(planner.locale,{day:"numeric",month:"numeric"})+" )",svgElement.appendChild(newElementtext)}date.setMonth(date.getMonth()+1)}},weekLevel:function(weeks,calendarWeek){let mult=0;if(52!==weeks[0])for(let first=weeks[0];first<=weeks[1];first++)calendarWeek===first&&(mult=first-weeks[0]);else if(52===calendarWeek)mult=0;else for(let first=1;first<=weeks[1];first++)calendarWeek===first&&(mult=first);return mult},inNextMonthMult:function(nextWeeks,calendarWeek){let nextMult=0;if(52===nextWeeks[0])if(52===calendarWeek)nextMult=0;else for(let first=1;first<=nextWeeks[1];first++)calendarWeek===first&&(nextMult=first);else for(let first=nextWeeks[0];first<=nextWeeks[1];first++)calendarWeek===first&&(nextMult=first-nextWeeks[0]);return nextMult},inPastMonthMult:function(pastWeeks,calendarWeek){let pastMult=0;for(let first=pastWeeks[0];first<=pastWeeks[1];first++)calendarWeek===first&&(pastMult=first-pastWeeks[0]);return pastMult},drawSecondTitleLine:function(item,line2,firstline,hover,hoverBack){if(item.title.length>25){(line2=document.createElementNS(NS,"tspan")).setAttributeNS(null,"x",parseInt(hover.getAttribute("x")).toString()),line2.setAttributeNS(null,"dy","1em"),line2.setAttributeNS(null,"class","planner-eventTitleTooltip");const words=firstline.textContent.split(" ");let line1="",line2text="";for(let i=0;i<words.length;i++){let test=line1+words[i]+" ";if(firstline.textContent.substring(0,test.length).length>25&&i>0){line2text=words.slice(i).join(" ");break}line1=test}line2.innerHTML=line2text,firstline.innerHTML=line1,hoverBack.setAttributeNS(null,"height","60px")}return line2},moveHover:function(hoverBack,hover,firstline,line2,secondline,thirdline,markerDiameter){if(parseInt(hoverBack.getAttributeNS(null,"x"))+220>svgElement.getAttributeNS(null,"width")){const difference=225+markerDiameter;hoverBack.setAttributeNS(null,"x",(hoverBack.getAttributeNS(null,"x")-difference).toString()),hover.setAttributeNS(null,"x",(hover.getAttributeNS(null,"x")-difference).toString()),firstline.setAttributeNS(null,"x",(firstline.getAttributeNS(null,"x")-difference).toString()),line2&&line2.setAttributeNS(null,"x",(line2.getAttributeNS(null,"x")-difference).toString()),secondline.setAttributeNS(null,"x",(secondline.getAttributeNS(null,"x")-difference).toString()),thirdline&&thirdline.setAttributeNS(null,"x",(thirdline.getAttributeNS(null,"x")-difference).toString())}},addThirdLineHover:function(item,thirdline,hover,hoverBack){return item.userid||((thirdline=document.createElementNS(NS,"tspan")).innerHTML=planner.strings.completed_by+" "+item.countcompleted+" "+planner.strings.students,thirdline.setAttributeNS(null,"x",parseInt(hover.getAttribute("x")).toString()),thirdline.setAttributeNS(null,"dy","1em"),hover.appendChild(thirdline),hoverBack.setAttributeNS(null,"height",(parseInt(hoverBack.getAttributeNS(null,"height"),10)+12).toString()+"px")),thirdline},createSecondLineMerge:function(text1,line2){if(text1.textContent.length>29){(line2=document.createElementNS(NS,"tspan")).setAttributeNS(null,"x",0),line2.setAttributeNS(null,"dy","1em"),line2.setAttributeNS(null,"class","planner-eventTitleTooltip");const words=text1.textContent.split(" ");let line1="",line2text="";for(let i=0;i<words.length;i++){let test=line1+words[i]+" ";if(text1.textContent.substring(0,test.length).length>29&&i>0){line2text=words.slice(i).join(" ");break}line1=test}line2.innerHTML=line2text,text1.textContent=line1}return line2},drawMarker:function(items){let newElement=null;items=items.filter((function(item){return-1!==planner.includedTypes.indexOf(item.type)&&(item.visible||planner.isteacher)&&1e3*item.startdate>=planner.startDate.getTime()&&1e3*item.startdate<=planner.endDate.getTime()}));const stackTracker={events:{},milestones:{},max:{events:0,milestones:0}},mobile=window.innerWidth<767;let count=items.length,markerPositions=new Array(count),overlapMap=[];for(let i=0;i<count;++i){var _stackTrack$xPos;const item=items[i],itemDate=new Date(1e3*item.startdate),itemWeek=this.getWeek(itemDate),monthOffset=itemDate.getMonth()-planner.startDate.getMonth()+12*(itemDate.getFullYear()-planner.startDate.getFullYear()),genericMonthCount=new Date(itemDate.getFullYear(),itemDate.getMonth()+1,0).getDate(),startDate=new Date(itemDate.getFullYear(),itemDate.getMonth(),1),endDate=new Date(itemDate.getFullYear(),itemDate.getMonth(),genericMonthCount);let xPos;xPos=mobile?0===itemDate.getDay()?planner.paddingleft+monthOffset*planner.monthWidth+monthOffset*planner.padding+2+(planner.monthWidth-4)/7*6+planner.weekWidth/7/2:planner.paddingleft+monthOffset*planner.monthWidth+monthOffset*planner.padding+2+(planner.monthWidth-4)/7*(itemDate.getDay()-1)+planner.weekWidth/7/2:planner.paddingleft+monthOffset*planner.monthWidth+monthOffset*planner.padding+2+(planner.monthWidth-4)/(endDate.getDate()-startDate.getDate())*(itemDate.getDate()-startDate.getDate());const type=item.userid?"milestones":"events",stackTrack=stackTracker[type],currentStackCount=stackTrack[xPos]=(null!==(_stackTrack$xPos=stackTrack[xPos])&&void 0!==_stackTrack$xPos?_stackTrack$xPos:0)+1;currentStackCount>stackTracker.max[type]&&(stackTracker.max[type]=currentStackCount),markerPositions[i]={x:xPos,stackPos:currentStackCount,week:itemWeek}}let markerDiameter=30,tooltipHeight=markerDiameter,needleLength=mobile?15:25,eventsStartY=mobile?tooltipHeight+needleLength-15+markerDiameter:tooltipHeight+needleLength-15+stackTracker.max.events*markerDiameter,milestonesStartY=mobile?eventsStartY:eventsStartY+planner.barHeight;planner.barPosY=eventsStartY+planner.barHeight/2,planner.weekHeight=80,svgHeight=mobile?6*planner.weekHeight+planner.barHeight:0===stackTracker.max.milestones?milestonesStartY+15:milestonesStartY+needleLength-15+stackTracker.max.milestones*markerDiameter+tooltipHeight,planner.updateSvgHeight(svgHeight);const startDate=new Date,endDate=new Date;let index=0;const currentDate=Date.now()/1e3,inOverMap=function(curVal,indx){return!!overlapMap[indx].includes(this)};overlapMap=this.checkForOverlaps(markerPositions,markerDiameter,overlapMap,inOverMap,items,mobile),items.forEach((function(item){const i=index++;let countDrawn=1,inPastMonth=!1,inNextMonth=!1;if(!overlapMap.find(inOverMap,markerPositions[i])){startDate.setTime(1e3*item.startdate),endDate.setTime(1e3*item.enddate);let needleStart,needleEnd,yPos,tooltipY,otherneedleStart,otherneedleEnd,otheryPos,othertooltipY,xPos=markerPositions[i].x,stackPos=markerPositions[i].stackPos;if(item.userid&&!mobile)needleStart=milestonesStartY,needleEnd=needleStart+needleLength,yPos=needleEnd+markerDiameter*(stackPos-1)+markerDiameter,tooltipY=needleEnd+(stackTracker.max.milestones-1)*markerDiameter+tooltipHeight;else if(mobile){const calendarWeek=planner.getWeek(startDate),weeks=planner.weeksInMonth.get(startDate.getMonth().toString()+startDate.getFullYear().toString()),copiedDate=new Date(startDate.getTime());copiedDate.setMonth(copiedDate.getMonth()-1);const pastWeeks=planner.weeksInMonth.get(copiedDate.getMonth().toString()+copiedDate.getFullYear().toString());copiedDate.setMonth(copiedDate.getMonth()+2);const nextWeeks=planner.weeksInMonth.get(copiedDate.getMonth().toString()+copiedDate.getFullYear().toString());void 0!==pastWeeks&&calendarWeek===pastWeeks[1]&&(inPastMonth=!0,countDrawn++),void 0!==nextWeeks&&calendarWeek===nextWeeks[0]&&(inNextMonth=!0,countDrawn++);let mult=planner.weekLevel(weeks,calendarWeek);if(inPastMonth){const pastMult=planner.inPastMonthMult(pastWeeks,calendarWeek);otherneedleStart=eventsStartY+pastMult*planner.weekHeight,otherneedleEnd=otherneedleStart-needleLength,otheryPos=otherneedleEnd,othertooltipY=otherneedleEnd-tooltipHeight}if(inNextMonth){const nextMult=planner.inNextMonthMult(nextWeeks,calendarWeek);otherneedleStart=eventsStartY+nextMult*planner.weekHeight,otherneedleEnd=otherneedleStart-needleLength,otheryPos=otherneedleEnd,othertooltipY=otherneedleEnd-tooltipHeight}needleStart=eventsStartY+mult*planner.weekHeight,needleEnd=needleStart-needleLength,yPos=needleEnd,tooltipY=needleEnd-tooltipHeight}else needleStart=eventsStartY,needleEnd=needleStart-needleLength,yPos=needleEnd-markerDiameter*(stackPos-1),tooltipY=needleEnd-(stackTracker.max.events-1)*markerDiameter-tooltipHeight;const anchor="start";for(let i=0;i<countDrawn;i++){1===i&&(inPastMonth?xPos-=planner.monthWidth+planner.padding+2:xPos+=planner.monthWidth+planner.padding+2,needleStart=otherneedleStart,needleEnd=otherneedleEnd,yPos=otheryPos,tooltipY=othertooltipY);const hoverBack=document.createElementNS(NS,"rect");hoverBack.setAttributeNS(null,"x",xPos+markerDiameter/2+5),hoverBack.setAttributeNS(null,"fill","white"),hoverBack.setAttributeNS(null,"rx","2"),hoverBack.setAttributeNS(null,"stroke",planner.primaryMarkerColour),hoverBack.style.display="none";const hover=document.createElementNS(NS,"text");hover.setAttributeNS(null,"class","hover"),hover.setAttributeNS(null,"x",xPos+markerDiameter/2+7),hover.setAttributeNS(null,"y",tooltipY-10),hover.setAttributeNS(null,"dy","6px"),hover.style.textAnchor=anchor,hover.style.fontSize="14px",hover.style.fontWeight="simple",hover.style.fontFamily="sans-serif",hover.style.display="none",hover.setAttributeNS(null,"fill","black");let firstline=document.createElementNS(NS,"tspan"),line2=null;const secondline=document.createElementNS(NS,"tspan");let thirdline=null;firstline.innerHTML=item.title,firstline.setAttributeNS(null,"x",parseInt(hover.getAttribute("x")).toString()),firstline.setAttributeNS(null,"dy","1em"),firstline.setAttributeNS(null,"class","planner-eventTitleTooltip"),line2=planner.drawSecondTitleLine(item,line2,firstline,hover,hoverBack),secondline.innerHTML=planner.dateFormatter.format(startDate)+", "+planner.timeFormatter.format(startDate)+" – "+planner.timeFormatter.format(endDate),secondline.setAttributeNS(null,"x",parseInt(hover.getAttribute("x")).toString()),secondline.setAttributeNS(null,"dy","1em"),hover.appendChild(firstline),hoverBack.setAttributeNS(null,"height","36px"),line2&&(hover.appendChild(line2),hoverBack.setAttributeNS(null,"height",(parseInt(hoverBack.getAttributeNS(null,"height"),10)+12).toString()+"px")),hover.appendChild(secondline),thirdline=planner.addThirdLineHover(item,thirdline,hover,hoverBack),hoverBack.setAttributeNS(null,"width","220px"),hover.setAttributeNS(null,"y",yPos-markerDiameter-10),hoverBack.setAttributeNS(null,"y",yPos-markerDiameter-10),planner.moveHover(hoverBack,hover,firstline,line2,secondline,thirdline,markerDiameter),svgElement.appendChild(hoverBack),svgElement.appendChild(hover);const fill=planner.getColor(item),stroke=item.enddate<currentDate?fill:planner.stillDueColour,label=item.type[0],mandatory=item.mandatory,graded=item.graded;(stackPos<=1||mobile)&&(newElement=document.createElementNS(NS,"line"),newElement.setAttributeNS(null,"x1",xPos),newElement.setAttributeNS(null,"y1",needleStart),newElement.setAttributeNS(null,"x2",xPos),newElement.setAttributeNS(null,"y2",needleEnd),newElement.style.stroke=stroke,newElement.style.strokeWidth="4",newElement.style.opacity="1",newElement.setAttributeNS(null,"cursor","pointer"),newElement.addEventListener("click",(()=>{planner.showModal(item)})),newElement.addEventListener("mouseover",(()=>{hover.style.display=null,hoverBack.style.display=null})),newElement.addEventListener("mouseout",(()=>{hover.style.display="none",hoverBack.style.display="none"})),svgElement.prepend(newElement));const rectElement=document.createElementNS(NS,"rect");rectElement.setAttributeNS(null,"id","event_"+item.id),rectElement.setAttributeNS(null,"x",xPos-markerDiameter/2),rectElement.setAttributeNS(null,"y",yPos-markerDiameter),rectElement.setAttributeNS(null,"height",markerDiameter),rectElement.setAttributeNS(null,"width",markerDiameter),rectElement.setAttributeNS(null,"rx",3.5),rectElement.setAttributeNS(null,"fill",fill),rectElement.style.stroke=stroke,rectElement.style.strokeWidth="3.5",rectElement.setAttributeNS(null,"cursor","pointer"),rectElement.addEventListener("click",(()=>{planner.showModal(item)})),rectElement.addEventListener("mouseover",(()=>{hover.style.display=null,hoverBack.style.display=null,rectElement.style.opacity="0.5"})),rectElement.addEventListener("mouseout",(()=>{hover.style.display="none",hoverBack.style.display="none",rectElement.style.opacity="1"})),newElement.after(rectElement);const textElement=document.createElementNS(NS,"text");rectElement.after(textElement),textElement.setAttributeNS(null,"x",xPos),textElement.setAttributeNS(null,"y",yPos-markerDiameter/2),textElement.setAttributeNS(null,"dy","6px"),graded&&(textElement.style.cssText+="text-decoration: underline",textElement.style.textDecorationColor=planner.stillDueColour),textElement.style.cssText+="text-anchor:middle;font-weight:bold;font-family:sans-serif",textElement.setAttributeNS(null,"fill",planner.stillDueColour),textElement.setAttributeNS(null,"cursor","pointer");const text=document.createElementNS(NS,"tspan");if(text.textContent=label,text.setAttributeNS(null,"fill",planner.fontColour),textElement.appendChild(text),mandatory){const asterisk=document.createElementNS(NS,"tspan");asterisk.setAttributeNS(null,"style","fill:#474747"),asterisk.textContent=" *",textElement.appendChild(asterisk)}textElement.addEventListener("click",(()=>{planner.showModal(item)})),textElement.addEventListener("mouseover",(()=>{hover.style.display=null,hoverBack.style.display=null,rectElement.style.opacity="0.5"})),textElement.addEventListener("mouseout",(()=>{hover.style.display="none",hoverBack.style.display="none",rectElement.style.opacity="1"}))}}})),overlapMap.forEach((function(overlap){startDate.setTime(1e3*items[markerPositions.indexOf(overlap[0])].startdate),endDate.setTime(1e3*items[markerPositions.indexOf(overlap[0])].enddate);const fill=items[markerPositions.indexOf(overlap[0])].userid&&!mobile?planner.milestoneColour:planner.primaryMarkerColour;let needleStart,needleEnd,yPos,otherneedleStart,otherneedleEnd,otheryPos,stroke,latestDate,inPastMonth=!1,countDrawn=1,oneMandatory=!1,oneGraded=!1;if(items[markerPositions.indexOf(overlap[0])].userid&&!mobile)needleStart=milestonesStartY,needleEnd=needleStart+needleLength,yPos=needleEnd+markerDiameter;else{const calendarWeek=planner.getWeek(new Date(1e3*items[markerPositions.indexOf(overlap[0])].startdate)),weeks=planner.weeksInMonth.get(startDate.getMonth().toString()+startDate.getFullYear().toString());let copiedDate=new Date(startDate.getTime());copiedDate.setMonth(copiedDate.getMonth()-1);const pastWeeks=planner.weeksInMonth.get(copiedDate.getMonth().toString()+copiedDate.getFullYear().toString());copiedDate.setMonth(copiedDate.getMonth()+2);const nextWeeks=planner.weeksInMonth.get(copiedDate.getMonth().toString()+copiedDate.getFullYear().toString());let mult=0;if(mobile){for(let first=weeks[0];first<=weeks[1];first++)calendarWeek===first&&(mult=first-weeks[0]);if(void 0!==pastWeeks&&calendarWeek===pastWeeks[1]){inPastMonth=!0,countDrawn++;const pastMult=planner.pastMergeMobile(weeks,pastWeeks,calendarWeek);otherneedleStart=eventsStartY+pastMult*planner.weekHeight,otherneedleEnd=otherneedleStart-needleLength,otheryPos=otherneedleEnd}if(void 0!==nextWeeks&&calendarWeek===nextWeeks[0]){countDrawn++;const nextMult=planner.nextMergeMobile(weeks,nextWeeks,calendarWeek);otherneedleStart=eventsStartY+nextMult*planner.weekHeight,otherneedleEnd=otherneedleStart-needleLength,otheryPos=otherneedleEnd}}needleStart=eventsStartY+mult*planner.weekHeight,needleEnd=needleStart-needleLength,yPos=needleEnd}overlap.sort(((a,b)=>a.x-b.x));let xPos=overlap[0].x,xPosEnd=overlap[overlap.length-1].x,width=xPosEnd+markerDiameter/2-(xPos-markerDiameter/2),center=xPos-markerDiameter/2+width/2;const links=[];overlap.forEach((function(element){const idx=markerPositions.indexOf(element);startDate.setTime(1e3*items[idx].startdate),endDate.setTime(1e3*items[idx].enddate),latestDate=items[idx].enddate;const lineStroke=items[idx].enddate<currentDate?fill:planner.stillDueColour;items[idx].mandatory&&(oneMandatory=!0),items[idx].graded&&(oneGraded=!0);const stackPos=element.stackPos,xPosEl=element.x,textWrapper=document.createElementNS(NS,"svg"),text=document.createElementNS(NS,"text");text.setAttributeNS(null,"x",0),text.setAttributeNS(null,"y",0);const text0=document.createElementNS(NS,"tspan");text0.setAttributeNS(null,"x",0),text0.setAttributeNS(null,"dy","1em"),text0.setAttributeNS(null,"class","planner-eventTitleTooltip"),text0.textContent=items[idx].mandatory?items[idx].type[0]+"*":items[idx].type[0],items[idx].graded&&text0.setAttributeNS(null,"text-decoration","underline"),text.appendChild(text0);const text1=document.createElementNS(NS,"tspan");text1.textContent=": "+items[idx].title,text1.setAttributeNS(null,"class","planner-eventTitleTooltip");let line2=null;line2=planner.createSecondLineMerge(text1,line2),text.appendChild(text1),textWrapper.setAttributeNS(null,"height","55px"),line2&&(text.appendChild(line2),textWrapper.setAttributeNS(null,"height","70px"));const text2=document.createElementNS(NS,"tspan");text2.setAttributeNS(null,"x",0),text2.setAttributeNS(null,"dy","1em"),text2.innerHTML+=planner.dateFormatter.format(startDate)+", "+planner.timeFormatter.format(startDate)+" – "+planner.timeFormatter.format(endDate),text.appendChild(text2);let text3=null;items[idx].userid||(text3=document.createElementNS(NS,"tspan"),text3.setAttributeNS(null,"x",0),text3.setAttributeNS(null,"dy","1em"),text3.innerHTML+=planner.strings.completed_by+" "+items[idx].countcompleted+" "+planner.strings.students,text.appendChild(text3)),textWrapper.appendChild(text),textWrapper.setAttributeNS(null,"width","100%");const dropdownLink=document.createElement("a");dropdownLink.appendChild(textWrapper),dropdownLink.setAttribute("class","dropdown-item"),dropdownLink.addEventListener("click",(()=>{planner.showModal(items[idx])})),links.push(dropdownLink),(stackPos<=1||mobile)&&(newElement=document.createElementNS(NS,"line"),newElement.setAttributeNS(null,"x1",xPosEl),newElement.setAttributeNS(null,"y1",needleStart),newElement.setAttributeNS(null,"x2",xPosEl),newElement.setAttributeNS(null,"y2",needleEnd),newElement.style.stroke=lineStroke,newElement.style.strokeWidth="4",newElement.setAttributeNS(null,"cursor","pointer"),svgElement.prepend(newElement))})),stroke=latestDate<currentDate?fill:planner.stillDueColour;for(let i=0;i<countDrawn;i++){const rectElement=document.createElementNS(NS,"rect");if(rectElement.setAttributeNS(null,"id","overlap_"+Math.floor(overlap[0].x)),1===i){inPastMonth?(xPos-=planner.monthWidth+planner.padding+2,center-=planner.monthWidth+planner.padding+2,xPosEnd-=planner.monthWidth+planner.padding+2):(xPos+=planner.monthWidth+planner.padding+2,center+=planner.monthWidth+planner.padding+2,xPosEnd+=planner.monthWidth+planner.padding+2),needleStart=otherneedleStart,needleEnd=otherneedleEnd,yPos=otheryPos;const newElement=document.createElementNS(NS,"line");newElement.setAttributeNS(null,"x1",xPos),newElement.setAttributeNS(null,"y1",needleStart),newElement.setAttributeNS(null,"x2",xPos),newElement.setAttributeNS(null,"y2",needleEnd),newElement.style.stroke=stroke,newElement.style.strokeWidth="4",newElement.setAttributeNS(null,"cursor","pointer"),svgElement.prepend(newElement),rectElement.setAttributeNS(null,"id","overlap_"+Math.floor(overlap[0].x)+"2")}rectElement.setAttributeNS(null,"class","merge");const positionX=xPos-markerDiameter/2,positionY=yPos-markerDiameter;rectElement.setAttributeNS(null,"x",positionX.toString()),rectElement.setAttributeNS(null,"y",positionY.toString()),rectElement.setAttributeNS(null,"height",markerDiameter.toString()),rectElement.setAttributeNS(null,"width",width.toString()),rectElement.setAttributeNS(null,"rx",3.5),rectElement.setAttributeNS(null,"fill",fill),rectElement.style.stroke=stroke,rectElement.style.strokeWidth="3.5",rectElement.setAttributeNS(null,"cursor","pointer"),rectElement.addEventListener("click",(event=>{planner.openPopup(links,event.clientX)})),rectElement.addEventListener("mouseover",(()=>{rectElement.style.opacity="0.5"})),rectElement.addEventListener("mouseout",(()=>{rectElement.style.opacity="1"})),newElement.after(rectElement);const label=overlap.length,textElement=document.createElementNS(NS,"text");rectElement.after(textElement),textElement.setAttributeNS(null,"x",center.toString()),textElement.setAttributeNS(null,"y",yPos-markerDiameter/2),textElement.setAttributeNS(null,"dy","6px"),textElement.setAttributeNS(null,"class","merge"),textElement.style.cssText+="text-anchor:middle;font-weight:bold;font-family:sans-serif",textElement.setAttributeNS(null,"fill",planner.stillDueColour);const text=document.createElementNS(NS,"tspan");if(text.textContent="#"+label,text.style.fill=planner.fontColour,text.setAttributeNS(null,"class","merge"),textElement.appendChild(text),oneMandatory){const asterisk=document.createElementNS(NS,"tspan");asterisk.style.fill=planner.stillDueColour,asterisk.textContent=" *",asterisk.setAttributeNS(null,"class","merge"),textElement.appendChild(asterisk)}oneGraded&&(textElement.setAttributeNS(null,"text-decoration","underline"),textElement.style.textDecorationColor=planner.stillDueColour),textElement.setAttributeNS(null,"cursor","pointer"),textElement.addEventListener("click",(event=>{planner.openPopup(links,event.clientX)})),textElement.addEventListener("mouseover",(()=>{rectElement.style.opacity="0.5"})),textElement.addEventListener("mouseout",(()=>{rectElement.style.opacity="1"}))}}))},openPopup:function(links,mousePosX){const popup=document.getElementById("planner-mergePopup");popup.innerHTML="",popup.style.display="block",window.innerWidth>767?mousePosX<window.innerWidth/2?popup.style.left=(mousePosX-50).toString()+"px":popup.style.left=(mousePosX-275-50).toString()+"px":popup.style.left=(window.innerWidth/2-132).toString()+"px",links.forEach((function(link){const wrapper=document.createElement("div");wrapper.setAttribute("class","planner-popupDropdownItem"),wrapper.appendChild(link),popup.appendChild(wrapper)}))},pastMergeMobile:function(weeks,pastWeeks,calendarWeek){let pastMult=0;for(let first=pastWeeks[0];first<=pastWeeks[1];first++)calendarWeek===first&&(pastMult=first-pastWeeks[0]);return pastMult},nextMergeMobile:function(weeks,nextWeeks,calendarWeek){let nextMult=0;for(let first=nextWeeks[0];first<=nextWeeks[1];first++)calendarWeek===first&&(nextMult=first-nextWeeks[0]);return nextMult},closePopup:function(){document.getElementById("planner-mergePopup").style.display="none"},getColor:(()=>{const now=Date.now()/1e3,threshold=now+604800;return event=>{const end=event.enddate;return event.completed&&planner.completedColour||event.userid&&planner.milestoneColour||end<now&&planner.primaryMarkerColour||end<=threshold&&planner.thresholdColour||planner.primaryMarkerColour}})(),checkForOverlaps:function(markerPositions,markerDiameter,overlapMap,inOverMap,items,mobile){const inOverMapCheck=function(curVal,indx){return!!overlapMap[indx].includes(this)};for(let i=0;i<markerPositions.length;i++){const occurences=[],iWeek=planner.getWeek(new Date(1e3*items[i].startdate));for(let j=0;j<i;j++){let found=!1;const jWeek=planner.getWeek(new Date(1e3*items[j].startdate));markerPositions[i].x<=markerPositions[j].x&&items[i].userid===items[j].userid?markerPositions[i].x+markerDiameter/2<markerPositions[j].x-markerDiameter/2||mobile&&jWeek!==iWeek||(found=!0):markerPositions[i].x>markerPositions[j].x&&items[i].userid===items[j].userid?markerPositions[i].x-markerDiameter/2>markerPositions[j].x+markerDiameter/2||mobile&&jWeek!==iWeek||(found=!0):markerPositions[i].x===markerPositions[j].x&&mobile&&iWeek===jWeek&&(found=!0),planner.overlapPushOccurences(overlapMap,inOverMapCheck,markerPositions[j],markerPositions[i],occurences,found)}if(occurences.length>1){const overlapMerge=[];for(let i=0;i<occurences.length;i++)overlapMap[occurences.at(i)].forEach((function(occ){overlapMerge.push(occ)}));for(let j=1;j<occurences.length;j++){const index=overlapMerge.indexOf(markerPositions[i]);overlapMerge.splice(index,1)}(overlapMap=overlapMap.reduce(((acc,value,index)=>(occurences.includes(index)||acc.push(value),acc)),[])).push(overlapMerge),occurences.length=0}}if(!mobile){const samePos=[];overlapMap.forEach((function(overlap,idx){let same=!0;overlap.forEach((function(el,idx){overlap[idx].x!==overlap[0].x&&(same=!1)})),!0===same&&samePos.push(idx)})),overlapMap=overlapMap.reduce(((acc,value,index)=>(samePos.includes(index)||acc.push(value),acc)),[])}return overlapMap},overlapPushOccurences:function(overlapMap,inOverMapCheck,markerPosj,markerPosi,occurences,found){if(found){const result=overlapMap.findIndex(inOverMapCheck,markerPosj);result>=0?overlapMap[result].includes(markerPosi)||(overlapMap[result].push(markerPosi),occurences.push(result)):occurences.push(overlapMap.push([markerPosi,markerPosj])-1)}},drawLegend:function(items){var _svgcontainer$offsetW;const svgWidth=null!==(_svgcontainer$offsetW=null==svgcontainer?void 0:svgcontainer.offsetWidth)&&void 0!==_svgcontainer$offsetW?_svgcontainer$offsetW:600,mobile=window.innerWidth<767;plannerLegend.setAttribute("width",svgWidth);const info=document.createElement("div");info.setAttribute("id","planner-info");const infoButton=document.createElement("button");infoButton.setAttribute("id","planner-infoMobile"),infoButton.setAttribute("type","button"),infoButton.setAttribute("class","planner-checkBtn"),infoButton.addEventListener("click",(()=>{info.style.left="0"})),infoButton.addEventListener("mouseover",(()=>{infoButton.style.opacity="0.5"})),infoButton.addEventListener("mouseout",(()=>{infoButton.style.opacity="1"})),infoButton.innerText="Info",mobile?(plannerOptions.appendChild(infoButton),plannerOptions.appendChild(info)):(plannerLegend.appendChild(infoButton),plannerLegend.appendChild(info));const start=planner.startDate.toLocaleString(planner.locale,{year:"numeric",month:"numeric",day:"numeric"}),end=planner.endDate.toLocaleString(planner.locale,{year:"numeric",month:"numeric",day:"numeric"}),legend={},marker={};items.forEach((function(item){const newdate=new Date(1e3*item.startdate);if(newdate<=planner.endDate&&(planner.isteacher||item.visible)){if(item.type in legend||(legend[item.type]=0),newdate<start||newdate>end)return;legend[item.type]=legend[item.type]+1,marker[item.type]=item.marker}}));const filter=[];let innerHTML="";for(let prop in legend)if(0!==legend[prop]&&(filter.push(prop),Object.prototype.hasOwnProperty.call(legend,prop))){var _eventStrings$prop;const propActual=null!==(_eventStrings$prop=eventStrings[prop])&&void 0!==_eventStrings$prop?_eventStrings$prop:prop;innerHTML+='<div class="d-inline-block" style="padding: 5px 10px; font-size: 16px; width: 220px;"><div class="d-inline-block font-weight-bold text-center" style="width: 32px; height: 32px;line-height: 28px; border-radius: 20%; border: 4px solid #a09e9e; color: #fff;background: #a09e9e; margin-right: 6px;">'+prop[0]+"</div>"+legend[prop]+" "+propActual+"</div>"}innerHTML+="<p class='ml-3 mb-0' style='font-size: 0.85em;'>"+planner.strings.legend+"</p>",planner.includeTypes=filter,null===planner.includedTypes&&(planner.includedTypes=planner.includeTypes),info.innerHTML=innerHTML},showModal:function(item){planner.isteacher?(log("OPEN","EVENT",null,item.id),planner.createEventModal(item)):"userid"in item&&"completed"in item?(log("OPEN","MILESTONE",null,item.id),planner.createMilestoneModal(item)):(log("OPEN","EVENT",null,item.id),planner.createEventCompletedModal(item))},createMenu:function(){null!==plannerMenu&&(svgWidth=plannerMenu.offsetWidth),plannerMenu.setAttribute("width",svgWidth);const form=document.createElement("form");form.addEventListener("click",(event=>{event.stopPropagation()})),form.setAttribute("id","menuform"),form.setAttribute("style","font-size: 16px; font-weight: normal; font-famiy: sans-serif"),planner.includeTypes.forEach((function(item){const input=document.createElement("input"),label=document.createElement("label");label.setAttribute("for",item),label.innerText=item,input.setAttribute("type","checkbox"),input.setAttribute("value",item),input.setAttribute("id",item),planner.includedTypes.includes(item)&&(input.checked=!0),input.addEventListener("change",(()=>{planner.includedTypes.includes(item)?(log("DESELECT","FILTER",item),planner.includedTypes=planner.includedTypes.filter((function(el){return el!==item}))):(log("SELECT","FILTER",item),planner.includedTypes.push(item)),planner.update()})),label.appendChild(input),form.appendChild(label)}));let mobilebutton=document.createElement("button");mobilebutton.setAttribute("type","button"),mobilebutton.setAttribute("id","planner-check"),mobilebutton.setAttribute("class","planner-checkBtn"),mobilebutton.addEventListener("click",(()=>{form.style.left="0"})),mobilebutton.addEventListener("mouseover",(()=>{mobilebutton.style.opacity="0.5"})),mobilebutton.addEventListener("mouseout",(()=>{mobilebutton.style.opacity="1"})),mobilebutton.innerText=planner.strings.options,plannerOptions.appendChild(mobilebutton);const actionForm=document.createElement("form");planner.isteacher?(actionForm.appendChild(planner.addNotificationCourseSettingsBtn()),actionForm.appendChild(planner.addEventBtn())):actionForm.appendChild(planner.addMilestoneBtn()),actionForm.appendChild(planner.addViewSelectionDrpdwn()),plannerOptions.appendChild(form),plannerActions.appendChild(actionForm)},resetModal:function(){require(["core_form/changechecker"],(function(ChangeChecker){ChangeChecker.startWatching(),ChangeChecker.resetAllFormDirtyStates()})),planner.update()},checkDateandTime:function(MandatoryFlag,e,modal){let startdate,enddate;for(let i=0;i<=5;i++){0===i?(startdate="startdate",enddate="enddate"):(startdate="date"+i,enddate="endtime"+i);const timestampofevent=new Date(document.getElementById("id_"+startdate+"_year").value,document.getElementById("id_"+startdate+"_month").value-1,document.getElementById("id_"+startdate+"_day").value).getTime();if(timestampofevent/1e3<planner.startDate.getTime()/1e3||timestampofevent/1e3>planner.endDate.getTime/1e3){MandatoryFlag=!1,e.preventDefault();(0,_str.get_string)("timeoutofrange","lytix_planner").then((function(localizedString){return modal.setBody(modal.getBody().innerHTML),modal.getBody().append(localizedString),localizedString})).catch((error=>{throw _log.default.warn(error),error}))}const starthour=parseInt(document.getElementById("id_"+startdate+"_hour").value),endhour=parseInt(document.getElementById("id_"+enddate+"hour").value),endminute=parseInt(document.getElementById("id_"+enddate+"minute").value),startminute=parseInt(document.getElementById("id_"+startdate+"_minute").value);if(endhour<starthour||starthour===endhour&&endminute<startminute){MandatoryFlag=!1,e.preventDefault();(0,_str.get_string)("time_smaller","lytix_planner").then((function(localizedString){return modal.setBody(modal.getBody().innerHTML),modal.getBody().append(localizedString),localizedString})).catch((error=>{throw _log.default.warn(error),error}))}if(1==document.getElementById("id_moreevents").value)break}return MandatoryFlag},createEventModal:function(item){const form=(0,_fragment.loadFragment)("lytix_planner","new_event_form",planner.contextid,item),title=planner.strings.event;let m;m=Number(M.cfg.version)<2024042200?_modal_factory.default.create({type:_modal_save_delete_cancelLazy.default,title:title,body:form}):_modal_save_delete_cancelLazy.default.create({title:title,body:form}),m.then((function(modal){modal.setLarge(),modal.show();const root=modal.getRoot();root.on(_modal_events.default.save,(function(e){const formData=root.find("form").serialize();let MandatoryFlag=!0;""===document.getElementById("id_title").value&&(MandatoryFlag=!1,e.preventDefault()),MandatoryFlag=planner.checkDateandTime(MandatoryFlag,e,modal);const selectedOption=document.getElementById("id_type").options[document.getElementById("id_type").selectedIndex];if("Other"===selectedOption.text&&(MandatoryFlag=!1,""===document.getElementById("id_select_other_german").value||""===document.getElementById("id_select_other_english").value?(e.preventDefault(),modal.setBody(modal.getBody().innerHTML),modal.getBody().append(planner.strings.type_required)):planner.includeTypes.includes(document.getElementById("id_select_other_german").value)||planner.includeTypes.includes(document.getElementById("id_select_other_english").value)?(e.preventDefault(),modal.setBody(modal.getBody().innerHTML),modal.getBody().append(planner.strings.type_exists)):MandatoryFlag=!0),MandatoryFlag){_ajax.default.call([{methodname:"local_lytix_lytix_planner_event",args:{contextid:planner.contextid,jsonformdata:JSON.stringify(formData)}}])[0].then((function(){planner.includedTypes.includes(selectedOption.text)||(planner.includedTypes.push(selectedOption.text),planner.includedTypes=null),planner.resetModal(),planner.update()})).catch((function(ex){_log.default.warn(ex),planner.resetModal()}))}})),root.on("modal-save-delete-cancel:delete",(function(){_ajax.default.call([{methodname:"local_lytix_lytix_planner_delete_event",args:{contextid:planner.contextid,courseid:planner.courseid,userid:planner.userid,id:item.id}}])[0].then((function(response){response.success&&(planner.resetModal(),planner.update())})).catch((function(ex){_log.default.warn(ex),planner.resetModal()}))})),root.on(_modal_events.default.hidden,(function(){log("CLOSE","EVENT",null,item.id),modal.hide(),modal.destroy()})),root.on(_modal_events.default.cancel,(function(){planner.resetModal()}))})).catch((function(ex){_log.default.warn(ex)}))},createEventCompletedModal:function(item){item.userid=planner.userid,item.eventid=item.id;const form=(0,_fragment.loadFragment)("lytix_planner","new_event_completed_form",planner.contextid,item),title=planner.strings.event_completed;_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:title,body:form}).then((function(modal){modal.setLarge(),modal.show();const root=modal.getRoot();root.on(_modal_events.default.save,(function(){const formData=root.find("form").serialize();_ajax.default.call([{methodname:"local_lytix_lytix_planner_event_completed",args:{contextid:planner.contextid,jsonformdata:JSON.stringify(formData)}}])[0].then((function(){planner.includeTypes.includes(root.find("form")[0][7].value)||planner.includeTypes.push(root.find("form")[0][7].value),planner.resetModal()})).catch((function(ex){_log.default.warn(ex),planner.resetModal()}))})),root.on(_modal_events.default.hidden,(function(){delete item.userid,delete item.eventid,log("CLOSE","EVENT",null,item.id),modal.hide(),modal.destroy()})),root.on(_modal_events.default.cancel,(function(){planner.resetModal()}))})).catch((function(ex){_log.default.warn(ex)}))},createCourseSettingsModal:function(){const form=(0,_fragment.loadFragment)("lytix_planner","new_course_notification_settings_form",planner.contextid,null),title=planner.strings.open_settings;_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:title,body:form}).then((function(modal){modal.setLarge(),modal.show();const root=modal.getRoot();root.on(_modal_events.default.save,(function(e){const formData=root.find("form").serialize();let MandatoryField=!0;if(!0===document.getElementById("id_new_type").checked&&(MandatoryField=!1,""===document.getElementById("id_select_other_german").value||""===document.getElementById("id_select_other_english").value?(e.preventDefault(),modal.setBody(modal.getBody().innerHTML),modal.getBody().append(planner.strings.type_required)):planner.includeTypes.includes(document.getElementById("id_select_other_german").value)||planner.includeTypes.includes(document.getElementById("id_select_other_english").value)?(e.preventDefault(),modal.setBody(modal.getBody().innerHTML),modal.getBody().append(planner.strings.type_exists)):MandatoryField=!0),planner.includeTypes.forEach((function(types){if(document.getElementById("id_delete"+types)&&!0===document.getElementById("id_delete"+types).checked){MandatoryField=!1,e.preventDefault();(0,_str.get_string)("type_not_deleteable","lytix_planner").then((function(localizedString){return modal.setBody(modal.getBody().innerHTML),modal.getBody().append(localizedString),localizedString})).catch((error=>{throw _log.default.warn(error),error}))}})),document.getElementById("id_softlock").checked&&!1===document.getElementById("id_new_type").checked&&MandatoryField||MandatoryField){_ajax.default.call([{methodname:"lytix_planner_store_course_notification_settings",args:{contextid:planner.contextid,courseid:planner.courseid,jsonformdata:JSON.stringify(formData)}}])[0].then((function(response){response.success||_log.default.warn("Error storing custom course settings!"),planner.includedTypes=null,planner.resetModal(),planner.update()})).catch((function(ex){_log.default.warn(ex),planner.resetModal()}))}})),root.on(_modal_events.default.hidden,(function(){log("CLOSE","SETTINGS"),modal.hide(),modal.destroy()})),root.on(_modal_events.default.cancel,(function(){planner.resetModal()}))})).catch((function(ex){_log.default.warn(ex)}))},addMilestoneBtn:function(){const item={id:-1};item.userid=planner.userid,item.marker="M",item.color="#6495ED";const addMilestoneBtn=document.createElement("button");addMilestoneBtn.setAttribute("class","btn btn-primary"),addMilestoneBtn.setAttribute("type","button"),addMilestoneBtn.setAttribute("value","Add Milestone"),addMilestoneBtn.setAttribute("data-action","Add Milestone"),addMilestoneBtn.setAttribute("style","display: inline-block; margin: 4px 4px 4px 12px; float: right;");const textPresent=planner.strings.add_milestone;return addMilestoneBtn.appendChild(document.createTextNode(textPresent)),addMilestoneBtn.addEventListener("click",(()=>{log("OPEN","MILESTONE",null,item.id),planner.createMilestoneModal(item)})),addMilestoneBtn},addEventBtn:function(){const item={id:-1};item.userid=planner.userid,item.marker="L",item.color="#6495ED",item.visible=1;const addEventBtn=document.createElement("button");addEventBtn.setAttribute("class","btn btn-primary"),addEventBtn.setAttribute("type","button"),addEventBtn.setAttribute("value","Add Event"),addEventBtn.setAttribute("data-action","Add Event"),addEventBtn.setAttribute("style","display: inline-block; margin: 4px 4px 4px 12px; float: right;");const textPresent=planner.strings.add_event;return addEventBtn.appendChild(document.createTextNode(textPresent)),addEventBtn.addEventListener("click",(()=>{log("OPEN","EVENT",null,item.id)})),addEventBtn.addEventListener("click",(()=>{planner.createEventModal(item)})),addEventBtn},addNotificationCourseSettingsBtn:function(){const userSettingsBtn=document.createElement("button");userSettingsBtn.setAttribute("class","btn btn-primary"),userSettingsBtn.setAttribute("type","button"),userSettingsBtn.setAttribute("value","notification_course_settings"),userSettingsBtn.setAttribute("data-action","notification_course_settings"),userSettingsBtn.setAttribute("style","display: inline-block; margin: 4px 4px 4px 12px; float: right;");const textPresent=planner.strings.open_settings;return userSettingsBtn.appendChild(document.createTextNode(textPresent)),userSettingsBtn.addEventListener("click",(()=>{log("OPEN","SETTINGS"),planner.createCourseSettingsModal()})),userSettingsBtn},addViewSelectionDrpdwn:function(){const viewSelectionsDrdwn=document.createElement("div");viewSelectionsDrdwn.setAttribute("class","planner-viewDropdown");const drdwnBtn=document.createElement("button");drdwnBtn.setAttribute("class","btn btn-secondary dropdown-toggle"),drdwnBtn.setAttribute("type","button"),drdwnBtn.setAttribute("id","dropdownMenuButton"),drdwnBtn.setAttribute("data-toggle","dropdown"),drdwnBtn.setAttribute("aria-haspopup","true"),drdwnBtn.setAttribute("aria-expanded","false"),drdwnBtn.setAttribute("style","display: inline-block; margin: 4px 4px 4px 12px; float: right;"),drdwnBtn.innerText=planner.strings.view+": "+planner.view,viewSelectionsDrdwn.appendChild(drdwnBtn);const menu=document.createElement("div");menu.setAttribute("class","dropdown-menu"),menu.setAttribute("aria-labelledby","dropdownMenuButton");const view1=document.createElement("a");view1.setAttribute("class","dropdown-item"),view1.setAttribute("href","#"),view1.innerText=planner.strings.month,view1.addEventListener("click",(()=>{planner.view=view1.innerText,drdwnBtn.innerText=planner.view,planner.update()}));const view3=document.createElement("a");view3.setAttribute("class","dropdown-item"),view3.setAttribute("href","#"),view3.innerText="3 "+planner.strings.months,view3.addEventListener("click",(()=>{planner.view=view3.innerText,drdwnBtn.innerText=planner.view,planner.update()}));const viewAll=document.createElement("a");return viewAll.setAttribute("class","dropdown-item"),viewAll.setAttribute("href","#"),viewAll.innerText=planner.locale.startsWith("de")?"gesamtes Semester":"entire semester",viewAll.addEventListener("click",(()=>{planner.view=viewAll.innerText,drdwnBtn.innerText=planner.view,planner.update()})),menu.appendChild(view1),menu.appendChild(view3),menu.appendChild(viewAll),viewSelectionsDrdwn.appendChild(menu),viewSelectionsDrdwn},createMilestoneModal:function(item){const form=(0,_fragment.loadFragment)("lytix_planner","new_milestone_form",planner.contextid,item),title=planner.strings.Milestone;let m;m=Number(M.cfg.version)<2024042200?_modal_factory.default.create({type:_modal_save_delete_cancelLazy.default,title:title,body:form}):_modal_save_delete_cancelLazy.default.create({title:title,body:form}),m.then((function(modal){modal.setLarge(),modal.show();const root=modal.getRoot();root.on(_modal_events.default.save,(function(e){const formData=root.find("form").serialize();let MandatoryFlag=!0;""===document.getElementById("id_title").value&&(MandatoryFlag=!1,e.preventDefault());const timestampofmilestone=new Date(document.getElementById("id_startdate_year").value,document.getElementById("id_startdate_month").value-1,document.getElementById("id_startdate_day").value).getTime();if(timestampofmilestone<planner.startDate||timestampofmilestone>planner.endDate){MandatoryFlag=!1,e.preventDefault();(0,_str.get_string)("timeoutofrange","lytix_planner").then((function(localizedString){return modal.setBody(modal.getBody().innerHTML),modal.getBody().append(localizedString),localizedString})).catch((error=>{throw _log.default.warn(error),error}))}const starthour=parseInt(document.getElementById("id_startdate_hour").value),endhour=parseInt(document.getElementById("id_hour").value),endminute=parseInt(document.getElementById("id_minute").value),startminute=parseInt(document.getElementById("id_startdate_minute").value);if(endhour<starthour||starthour===endhour&&endminute<startminute){MandatoryFlag=!1,e.preventDefault();(0,_str.get_string)("time_smaller","lytix_planner").then((function(localizedString){return modal.setBody(modal.getBody().innerHTML),modal.getBody().append(localizedString),localizedString})).catch((error=>{throw _log.default.warn(error),error}))}if(MandatoryFlag){_ajax.default.call([{methodname:"local_lytix_lytix_planner_milestone",args:{contextid:planner.contextid,jsonformdata:JSON.stringify(formData)}}])[0].then((function(){planner.includedTypes.includes("Milestone")||planner.includedTypes.push("Milestone"),planner.resetModal()})).catch((function(ex){_log.default.warn(ex),planner.resetModal()}))}})),root.on("modal-save-delete-cancel:delete",(function(){_ajax.default.call([{methodname:"local_lytix_lytix_planner_delete_milestone",args:{contextid:planner.contextid,courseid:planner.courseid,userid:planner.userid,id:item.id}}])[0].then((response=>{response.success&&(planner.resetModal(),planner.update())})).catch((function(ex){_log.default.warn(ex),planner.resetModal()}))})),root.on(_modal_events.default.hidden,(function(){log("CLOSE","MILESTONE",null,item.id),modal.hide(),modal.destroy()})),root.on(_modal_events.default.cancel,(function(){planner.resetModal()}))})).catch((function(ex){_log.default.warn(ex)}))},renderModalFail:function(ex,id){document.querySelector("#"+id+".modal-body").innerHTML=planner.strings.error_text+"<p>"+ex.message+"</p>"},update:function(){const urlParams=new URLSearchParams(window.location.search);let id=0;urlParams.has("id")&&(id=urlParams.get("id")),_ajax.default.call([{methodname:"local_lytix_lytix_planner_get",args:{id:id,contextid:planner.contextid,isstudent:!planner.isteacher}}])[0].then((function(response){planner.init(response),planner.storeEvents(response.items),planner.drawLegend(planner.data.items),planner.createMenu(),planner.drawMarker(planner.data.items),planner.drawplanner()})).catch((function(ex){document.getElementById("planner_menu").innerHTML=planner.strings.error_text+"<p>"+ex.message+"</p>"}))},getWeek:function(curDate){const date=new Date(curDate.getTime());date.setHours(0,0,0,0),date.setDate(date.getDate()+3-(date.getDay()+6)%7);const week1=new Date(date.getFullYear(),0,4);return 1+Math.round(((date.getTime()-week1.getTime())/864e5-3+(week1.getDay()+6)%7)/7)}};_exports.init=async(contextid,courseid,userid,isteacher,locale)=>{planner.isteacher=isteacher,locale=_widget.default.convertLocale(locale),planner.strings=await(0,_widget.getStrings)({lytix_planner:{identical:["add_milestone","add_event","Milestone","event","event_completed","error_text","loading_msg","open_settings","type_exists","type_required","costum_settings","event_limit","legend","view","month","months","next","previous_month","options","calendarweek","completed_by","students","description_teacher","description_student","Milestone","Lecture","Exam","Assignment","Feedback","Interview","Other","Quiz"]}});{const strings=planner.strings,stringIdentifiers=["Assignment","Exam","Feedback","Interview","Lecture","Milestone","Quiz"],eventIdentifiers="de"==locale.slice(0,2)?["Aufgabe","Prüfung","Feedback","Abgabegespräch","Vorlesung","Meilenstein","Quiz"]:stringIdentifiers;for(let i=stringIdentifiers.length-1;i>=0;--i)eventStrings[eventIdentifiers[i]]=strings[stringIdentifiers[i]]}let resizeTimer;planner.drawLoading(),planner.contextid=contextid,planner.courseid=courseid,planner.userid=userid,planner.locale=locale,planner.dateFormatter=new Intl.DateTimeFormat(planner.locale,{day:"numeric",month:"numeric",year:"2-digit"}),planner.timeFormatter=new Intl.DateTimeFormat(planner.locale,{hour:"2-digit",minute:"2-digit"}),planner.update(),log=(0,_logs.makeLoggingFunction)(userid,courseid,contextid,"planner"),window.addEventListener("resize",(()=>{clearTimeout(resizeTimer),resizeTimer=setTimeout((()=>{planner.update()}),250)}))}}));

//# sourceMappingURL=planner-lazy.min.js.map